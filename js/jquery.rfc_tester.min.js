(function(n){var d={init:function(a){var b=n.extend({nombre:null,primerapellido:null,segundoapellido:null,dia:null,mes:null,ano:null,change:null,success:null,error:null,selfcomplete:!1},a);return this.each(function(){var a=null,h=null,g=null,l=/^([A-Z&\u00D1]{3})([0-9]{6})([0-9A-Z]{3})$/i,k=/^([A-Z&\u00D1]{4})([0-9]{6})([0-9A-Z]{3})$/i;n(this).keyup(function(){var e=d.normalizeClave(n(this).val().toUpperCase()),f=null,m=null;b.change&&b.change.call(this);b.selfcomplete?/^([A-Z&\u00D1]{4})([0-9]{6})$/i.test(e)&&
(b.nombre.val()&&b.primerapellido.val()?(a=d.clave(b.nombre.val().toUpperCase(),b.primerapellido.val().toUpperCase(),b.segundoapellido.val().toUpperCase(),b.dia?b.dia.val():d.extract2("day",e),b.mes?b.mes.val():d.extract2("month",e),b.ano?b.ano.val():d.extract2("year",e)),h=d.homonimia(b.primerapellido.val().toUpperCase()+" "+b.segundoapellido.val().toUpperCase()+" "+b.nombre.val().toUpperCase()),g=d.digitoVerificador(a.substring(0,12)),e+h+g===a?(n(this).attr("value",a),b.success&&b.success.call(this,
a)):(m=a,b.error&&b.error.call(this,"Error:\n"+("La parte inicial de la clave ("+e+") no coincide con la informaci\u00f3n que se obtiened del nombre del contribuyente."),m))):b.error&&b.error.call(this,"Error:\nEs necesario, para completar autom\u00e1ticamente la clave del R.F.C. que introduzca primero el nombre y el (los) apellido(s) del contribuyente.",null)):k.test(e)?(a=d.clave(b.nombre.val().toUpperCase(),b.primerapellido.val().toUpperCase(),b.segundoapellido.val().toUpperCase(),b.dia?b.dia.val():
d.extract("day",e),b.mes?b.mes.val():d.extract("month",e),b.ano?b.ano.val():d.extract("year",e)),h=d.homonimia(b.primerapellido.val().toUpperCase()+" "+b.segundoapellido.val().toUpperCase()+" "+b.nombre.val().toUpperCase()),g=d.digitoVerificador(a.substring(0,12)),h!=d.extract("homonimia",e)&&(f="Clave diferenciadora de homonimia suministrada ("+d.extract("homonimia",e)+") no coincide con la que se obtiene de los nombres suministrados ("+h+"). La raz\u00f3n de esta discrepancia se puede deber a una incorrecta captura del nombre o apellidos del contribuyente."),
g!=d.extract("digito_verificador",e)&&(f=f+"\nDigito verificador suministrador ("+d.extract("digito_verificador",e)+") no coincide con el que se obtiene de la clave del R.F.C. ("+g+"). Posiblemente la clave del R.F.C. se esta capturando incorrectamente."),e!=a&&(f=f+"\nLa clave del R.F.C. suministrada ("+e+") no coincide con la c\u00e1lculada ("+a+")",m=a),/^([A-Z&\u00D1]{4})([0-9]{2})((0[1-9])|(1[012]))((0[1-9])|([12][0-9])|(3[01]))([1-9A-NP-Z]{2})[0-9A]$/i.test(e)||(f+="\nClave del R.F.C. no bien formada."),
f?b.error&&b.error.call(this,"Error:\n"+f,m):b.success&&b.success.call(this,e)):l.test(e)&&(g=d.digitoVerificador(e.substring(0,11)),d.extract("digito_verificador",e),g!=d.extract("digito_verificador",e)&&(f="El digito verificador suministrado con la clave del R.F.C. ("+d.extract("digito_verificador",e)+") no coincide con el que se obtiene directamente del c\u00e1lculo de la clave ("+g+")",m=e.substring(0,11)+g),/^([A-Z&\u00D1]{3})([0-9]{2})((0[1-9])|(1[012]))((0[1-9])|([12][0-9])|(3[01]))([1-9A-NP-Z]{2})[0-9A]$/i.test(e)||
(f+="\nClave del R.F.C. no bien formada."),f?b.error&&b.error.call(this,"Error:\n"+f,m):b.success&&b.success.call(this,e))})})},clave:function(a,b,c,h,g,l){var k=null,e=[],f=[],m=[],f=e=void 0,e=d.regla8(d.normalize(a.toUpperCase())),e=d.regla6(e),f=d.regla8(d.normalize(b.toUpperCase()));c&&(m=d.regla8(d.normalize(c.toUpperCase())));2>=f[0].length&&(k=m.length?d.regla4(e[0],f[0],m[0]):d.regla7(e[0],f[0]));0===m.length&&(k=d.regla7(e[0],f[0]));null===k&&(k=d.regla1(e[0],f[0],m[0]));k=d.regla9(k);k+=
d.regla2(h,g,l);e=d.homonimia((b+" "+c+" "+a).toUpperCase());f=d.digitoVerificador(k+e);return k+e+f},extract:function(a,b){var c=null;"year"===a?c=/\d{2}(?=(\d{4}))/:"month"===a?c=/\d{2}(?=(\w{5}$))/:"day"===a?c=/\d{2}(?=(\w{3}$))/:"homonimia"===a?c=/\w{2}(?=(\w(?=$)))/:"digito_verificador"===a&&(c=/\w(?=$)/);return c?c.exec(b)[0]:null},extract2:function(a,b){var c=b.match(/\d{2}/g);return"year"===a?c[0]:"month"===a?c[1]:"day"===a?c[2]:null},homonimia:function(a){for(var b={" ":0,"0":0,1:1,2:2,3:3,
4:4,5:5,6:6,7:7,8:8,9:9,"&":10,A:11,B:12,C:13,D:14,E:15,F:16,G:17,H:18,I:19,J:21,K:22,L:23,M:24,N:25,O:26,P:27,Q:28,R:29,S:32,T:33,U:34,V:35,W:36,X:37,Y:38,Z:39,"\u00d1":40,"\u00c1":11,"\u00c9":15,"\u00cd":19,"\u00d3":26,"\u00da":34},c={"0":"1",1:"2",2:"3",3:"4",4:"5",5:"6",6:"7",7:"8",8:"9",9:"A",10:"B",11:"C",12:"D",13:"E",14:"F",15:"G",16:"H",17:"I",18:"J",19:"K",20:"L",21:"M",22:"N",23:"P",24:"Q",25:"R",26:"S",27:"T",28:"U",29:"V",30:"W",31:"X",32:"Y",33:"Z"},h=0,g=0,l=null,k=0,e=0,f=0,m=null,
m=/\w|\s|&|\u00D1|\u00C1|\u00C9|\u00CD|\u00D3|\u00DA/,p=0;p<a.length;p++)l=a.charAt(p),m.test(l)&&(n.each(b,function(a,b){k=b;return l!=a}),g+=(10*h+d.decena(k))*d.decena(k),h=k%10,g+=k*h);g%=1E3;e=g%34;f=(g-e)/34;n.each(c,function(a,b){l=b;return f!=a});m=l;n.each(c,function(a,b){l=b;return e!=a});return m+l},decena:function(a){return 30<=a?3:20<=a?2:10<=a?1:0},digitoVerificador:function(a){var b={"0":0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,G:16,H:17,I:18,J:19,K:20,L:21,
M:22,N:23,"&":24,O:25,P:26,Q:27,R:28,S:29,T:30,U:31,V:32,W:33,X:34,Y:35,Z:36," ":37,"\u00d1":38},c="",d=0,g=0,l=0,l=13,k=null,k=11===a.length?" "+a:a;for(a=0;a<k.length;a++)c=k.charAt(a),n.each(b,function(a,b){d=b;return c!=a}),g+=d*l,l-=1;l=g%11;return 0==l?"0":1==l?"A":11-l},normalizeClave:function(a){return a.replace(/[ -]/g,"")},regla1:function(a,b,c){var d=b.substring(1).match(/A|E|I|O|U|\u00C1|\u00C9|\u00CD|\u00D3|\u00DA/i)[0].charAt(0);return b.charAt(0)+d+c.charAt(0)+a.charAt(0)},regla2:function(a,
b,c){1===a.length&&(a="0"+a);1===b.length&&(b="0"+b);1===c.length?c="0"+c:4===c.length&&(c=c.substr(2));return c+b+a},regla3:function(a){var b=void 0;return b=a.match(/^CH|^LL/i)?a.charAt(0)+a.substring(2):a},regla4:function(a,b,c){return b.charAt(0)+c.charAt(0)+a.charAt(0)+a.charAt(1)},regla5:function(a,b,c){},regla6:function(a){for(var b=[],c=0;c<a.length;c++)"MARIA"===a[c]||("MAR\u00cdA"===a[c]||"JOSE"===a[c]||"JOS\u00c9"===a[c])||b.push(a[c]);return b},regla7:function(a,b){return b.charAt(0)+
b.charAt(1)+a.charAt(0)+a.charAt(1)},regla8:function(a){var b=[];a=a.split(" ");for(var c=0;c<a.length;c++)a[c].length&&!("DE"===a[c]||"DEL"===a[c]||"LA"===a[c]||"LAS"===a[c]||"LOS"===a[c]||"MC"===a[c]||"MAC"===a[c]||"MI"===a[c]||"VAN"===a[c]||"VON"===a[c]||"Y"===a[c])&&b.push(a[c]);return b},regla9:function(a){var b=void 0;return b="BUEI"===a||"BUEY"===a||"CACA"===a||"CACO"===a||"CAGA"===a||"CAGO"===a||"CAKA"===a||"COGE"===a||"COJA"===a||"COJE"===a||"COJI"===a||"COJO"===a||"CULO"===a||"FETO"===a||
"GUEY"===a||"JOTO"===a||"KACA"===a||"KACO"===a||"KAGA"===a||"KAGO"===a||"KOGE"===a||"KOJO"===a||"KAKA"===a||"KULO"===a||"MAME"===a||"MAMO"===a||"MEAR"===a||"MEON"===a||"MION"===a||"MOCO"===a||"MULA"===a||"PEDA"===a||"PEDO"===a||"PENE"===a||"PUTA"===a||"PUTO"===a||"QULO"===a||"RATA"===a||"RUIN"===a?a.charAt(0)+a.charAt(1)+a.charAt(2)+"X":a},normalize:function(a){for(var b="",c=null,h=0;h<a.length;h++){if("\u00c1"===a.charAt(h))c="A";else if("\u00c9"===a.charAt(h))c="E";else if("\u00cd"===a.charAt(h))c=
"I";else if("\u00d3"===a.charAt(h))c="O";else if("\u00da"===a.charAt(h))c="U";else if("."===a.charAt(h))continue;else if("'"===a.charAt(h))continue;else c=a.charAt(h);b+=c}return d.regla3(b)}};n.fn.rfc_tester=function(a){if(d[a])return d[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof a||!a)return d.init.apply(this,arguments);n.error("El m\u00e9todo "+a+" no existe en la presente implementaci\u00f3n.")}})(jQuery);
